{% extends 'base.html' %}
{% block content %}
<h1>border0 config</h1>

<!-- Organization setup -->
<div class="card mb-4">
  <div class="card-body">
    <form method="post" class="row g-3">
  <div class="col-md-8">
        <label for="org" class="form-label">Organization Name</label>
        <input type="text" class="form-control" id="org" name="org" value="{{ org }}" required maxlength="30">
      </div>
      <div class="col-md-4 align-self-end">
        <button type="submit" name="action" value="save_org" class="btn btn-primary">Save Organization</button>
      </div>
    </form>
  </div>
</div>

{# Show current organization if already set #}
{% if org %}
  <div class="mb-4">
    <p>Current organization: <strong>{{ org }}</strong></p>
  </div>
{% endif %}

<!-- Initiate login and service management -->
{% if org %}
  {% if login_url %}
    <div class="alert alert-info">
      <script>window.open('{{ login_url }}', '_blank');</script>
      <p>A new window has been opened for Border0 authentication.<br>
      If it didnâ€™t open automatically, <a href="{{ login_url }}" target="_blank">click here</a> to proceed.</p>
      <p>Once authentication is complete, reload this page to continue.</p>
    </div>
  {% endif %}
  <div class="mb-4">
    <form method="post" class="d-flex gap-2">
      <button type="submit" name="action" value="login" class="btn btn-primary">Login to border0</button>
      {% if token_exists %}
        <button type="submit" name="action" value="install_vpn" class="btn btn-primary">Restart border0 service</button>
      {% endif %}
    </form>
  </div>
{% endif %}

<!-- Token upload and VPN installation -->
{% if not token_exists %}
  <div class="card mb-4">
    <div class="card-body">
      <p>No Border0 client token found. Please paste your client token below:</p>
      <form method="post">
        <div class="mb-3">
          <label for="token" class="form-label">Client Token</label>
          <textarea class="form-control" id="token" name="token" rows="5" required></textarea>
        </div>
        <button type="submit" name="action" value="upload_token" class="btn btn-primary">Save Token</button>
      </form>
    </div>
  </div>
{%- endif %}
{% endblock %}
