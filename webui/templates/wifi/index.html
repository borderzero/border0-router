{% extends 'base.html' %}
{% block content %}
<h1>Wi-Fi Configuration</h1>
<div class="mb-4">
  <p class="text-muted">Configure each wireless interface below. Set the SSID (network name), hardware mode, and WPA2 passphrase. Use the action buttons to enable, disable, or restart the Wi-Fi service. The current service status is shown alongside the controls.</p>
</div>
{% if interfaces %}
  {% for iface in interfaces %}
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-header"><strong>{{ iface.name }}</strong> Configuration</div>
          <div class="card-body">
            <form method="post" action="{{ url_for('wifi.save', iface=iface.name) }}">
              <div class="mb-3">
                <label for="ssid-{{ iface.name }}" class="form-label">SSID</label>
                <input type="text" class="form-control" id="ssid-{{ iface.name }}" name="ssid"
                       value="{{ iface.ssid }}" required maxlength="32">
                <div class="form-text">Network name (SSID) broadcast by this interface.</div>
              </div>
              <div class="mb-3">
                <label for="hw_mode-{{ iface.name }}" class="form-label">HW Mode</label>
                <select class="form-select" id="hw_mode-{{ iface.name }}" name="hw_mode" required>
                  {% for mode in hw_modes %}
                    <option value="{{ mode }}" {% if iface.hw_mode == mode %}selected{% endif %}>
                      {{ hw_mode_labels[mode] }}
                    </option>
                  {% endfor %}
                </select>
                <div class="form-text">Select the Wi-Fi mode; labels include typical speed options.</div>
              </div>
              <div class="mb-3">
                <label for="passphrase-{{ iface.name }}" class="form-label">WPA2 Passphrase</label>
                <div class="input-group">
                  <input type="password" class="form-control" id="passphrase-{{ iface.name }}" name="wpa_passphrase"
                         value="{{ iface.wpa_passphrase }}" required minlength="8" maxlength="63">
                  <button class="btn btn-outline-secondary" type="button" id="toggle-pass-{{ iface.name }}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" stroke="currentColor"
                         stroke-width="2" stroke-linecap="round" stroke-linejoin="round" viewBox="0 0 24 24">
                      <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                      <circle cx="12" cy="12" r="3"/>
                    </svg>
                  </button>
                </div>
                <div class="form-text">Passphrase must be 8â€“63 characters long to secure your network.</div>
              </div>
              <div class="d-flex align-items-center">
                <button type="submit" name="action" value="save" class="btn btn-primary me-2">Save Settings</button>
                {% if iface.service_enabled %}
                  <button type="submit" name="action" value="disable" class="btn btn-warning me-2" formnovalidate>Disable Service</button>
                {% else %}
                  <button type="submit" name="action" value="enable" class="btn btn-success me-2" formnovalidate>Enable Service</button>
                {% endif %}
                <button type="submit" name="action" value="restart" class="btn btn-secondary" formnovalidate>Restart Service</button>
                <div class="ms-3">
                  <span class="fw-bold {{ 'text-success' if iface.service_enabled else 'text-danger' }}">{{ 'Enabled' if iface.service_enabled else 'Disabled' }}</span>
                  &nbsp;/&nbsp;
                  <span class="fw-bold {{ 'text-success' if iface.service_active else 'text-danger' }}">{{ 'Active' if iface.service_active else 'Inactive' }}</span>
                </div>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card h-100">
          <div class="card-header"><strong>{{ iface.name }}</strong> Statistics</div>
          <div class="card-body">
            <pre style="white-space: pre-wrap;">{{ iface.stats }}</pre>
          </div>
        </div>
      </div>
    </div>
  {% endfor %}
{% else %}
  <p>No Wi-Fi interfaces found.</p>
{% endif %}
{% endblock %}
{% block scripts %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      {% for iface in interfaces %}
      (function() {
        var toggleBtn = document.getElementById('toggle-pass-{{ iface.name }}');
        var passwordInput = document.getElementById('passphrase-{{ iface.name }}');
        if (toggleBtn && passwordInput) {
          toggleBtn.addEventListener('click', function() {
            passwordInput.type = passwordInput.type === 'password' ? 'text' : 'password';
          });
        }
      })();
      {% endfor %}
    });
  </script>
{% endblock %}
